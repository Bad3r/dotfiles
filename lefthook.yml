# Lefthook configuration for dotfiles repository
# https://github.com/evilmartians/lefthook
#
# Install hooks: lefthook install
# Run manually:  lefthook run pre-commit
#
# Required tools (install via nix-shell or package manager):
#   - typos: spell checker for code (crate-ci/typos)
#   - ripsecrets: secret detection (sirwart/ripsecrets)

assert_lefthook_installed: true
no_tty: false
colors: true

pre-commit:
  parallel: true
  commands:
    ripsecrets:
      priority: 1
      glob: "!*.{pdf,png,jpg,jpeg,gif,ico,woff,woff2,ttf,eot,svg,mp3,mp4,zip,tar,gz,bin,exe,AppImage,asar}"
      run: ripsecrets --strict-ignore {staged_files}
      skip:
        - run: "! command -v ripsecrets >/dev/null 2>&1"
          msg: "ripsecrets not installed, skipping"
        - merge
        - rebase

    typos:
      priority: 2
      glob: "!{.git,node_modules,*.pdf,*.png,*.jpg,*.jpeg,*.gif,*.ico,*.woff,*.woff2,*.ttf,*.eot,*.mp3,*.mp4,*.zip,*.tar,*.gz,*.bin,*.exe,*.AppImage,*.asar,*.pyc,*.zwc}/**"
      run: typos --config .typos.toml --force-exclude {staged_files}
      skip:
        - run: "! command -v typos >/dev/null 2>&1"
          msg: "typos not installed, skipping"
        - merge
        - rebase

# Optional: validate commit message format
# Uncomment to enable conventional commits
# commit-msg:
#   commands:
#     conventional-commit:
#       run: |
#         msg=$(cat "$1")
#         pattern="^(feat|fix|chore|docs|style|refactor|perf|test|build|ci|revert)(\(.+\))?: .{1,72}"
#         if ! echo "$msg" | grep -qE "$pattern"; then
#           echo "ERROR: Commit message doesn't follow conventional commits format"
#           echo "Format: type(scope): description"
#           echo "Types: feat, fix, chore, docs, style, refactor, perf, test, build, ci, revert"
#           exit 1
#         fi

# Pre-push hook for more expensive checks
# pre-push:
#   commands:
#     full-secret-scan:
#       run: ripsecrets --strict-ignore .
