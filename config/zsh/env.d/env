#!/bin/sh
# ~/.config/zsh/env.d/env - Shared POSIX-compliant environment variables
# Sourced by ~/.profile (for GUI) and ~/.zshenv (for shells)

# Idempotency Guard: Track sourcing context
# Don't export this variable - it should be local to each shell session
_CURRENT_SHELL_PID=$$
if [ -n "$_ENV_SOURCED_PID" ] && [ "$_ENV_SOURCED_PID" = "$_CURRENT_SHELL_PID" ]; then
  return
fi
_ENV_SOURCED_PID=$_CURRENT_SHELL_PID

# Locale
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

# User Common Dirs
export USR_LOCAL_DIR="$HOME/.local"
export USR_BIN_DIR="$HOME/.local/bin"
export USR_LIB_DIR="$HOME/.local/lib"

# Defaults
export TERM="xterm-256color"
export TERMINAL="xterm"
export COLORTERM="truecolor"

export EDITOR="vi"
export DIFFPROG="vimdiff"
export VISUAL=$EDITOR

# Set default pager (will be overridden if bat is available)
export PAGER="less"
export MANPAGER="less"
export MANWIDTH=120

export BROWSER="firefox"
export READER="xdg-open"
export IMAGE="feh"

export OPENER="xdg-open"

export WM="i3"
export SHELL="/usr/bin/zsh"

# Git repo for dotfiles
export DOTFILES="$HOME/dotfiles"



# Node
# Increase max memory
export NODE_OPTIONS="--max-old-space-size=16384"


# set font for Nordic theme
# PKG: nordic-darker-theme-git
export THEME_FONT_FACE="MonoLisa Variable"
export THEME_FONT_SIZE=11

# set default file manager
export FILE_MANAGER="thunar"

# set default video player
export VIDEO_PLAYER="mpv"


# disable telemetry
export DOTNET_CLI_TELEMETRY_OPTOUT=1

# GPG
if [ -t 0 ]; then
  GPG_TTY=$(tty)
  export GPG_TTY
fi

# PATH configuration
# Base paths
PATH="$HOME/.local/bin:$HOME/bin${PATH:+:$PATH}"

#  Emacs Packages
[ -d "$HOME/.emacs.d/bin" ] && PATH="$PATH:$HOME/.emacs.d/bin"

# Go Packages
export GOPATH="${GOPATH:=$HOME/go}"
export GOBIN="${GOBIN:=$GOPATH/bin}"
[ -d "$GOBIN" ] && PATH="$PATH:$GOBIN"

# Rust Cargo Packages
export CARGO_HOME="${CARGO_HOME:=$XDG_CONFIG_HOME/cargo}"
[ -d "$CARGO_HOME/bin" ] && PATH="$PATH:$CARGO_HOME/bin"

# Ruby Gems
export GEM_HOME="${GEM_HOME:=$HOME/.gem}"
[ -d "$GEM_HOME/bin" ] && PATH="$PATH:$GEM_HOME/bin"

# ClojureScript
[ -d "/opt/clojurescript/bin" ] && PATH="$PATH:/opt/clojurescript/bin"

# .NET Tools
export DOTNET_ROOT="${DOTNET_ROOT:=/usr/share/dotnet}"
export DOTNET_TOOLS_PATH="${DOTNET_TOOLS_PATH:=$HOME/.dotnet/tools}"
[ -d "$DOTNET_TOOLS_PATH" ] && PATH="$PATH:$DOTNET_TOOLS_PATH"

# Yarn Global Packages (no standard env var)
[ -d "$HOME/.yarn/bin" ] && PATH="$PATH:$HOME/.yarn/bin"

# Dart/Flutter Pub Packages
export PUB_CACHE="${PUB_CACHE:=$HOME/.pub-cache}"
[ -d "$PUB_CACHE/bin" ] && PATH="$PATH:$PUB_CACHE/bin"

# Node/NPM Global Packages
export npm_config_prefix="${npm_config_prefix:=$HOME/.npm-global}"
[ -d "$npm_config_prefix/bin" ] && PATH="$PATH:$npm_config_prefix/bin"

# Claude
[ -d "$HOME/.claude/local" ] && PATH="$PATH:$HOME/.claude/local"

export PATH
