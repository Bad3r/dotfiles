#!/bin/sh
# ~/.config/zsh/env.d/env - Shared POSIX-compliant environment variables
# Sourced by ~/.profile (for GUI) and ~/.zshenv (for shells)

# Idempotency Guard: Track sourcing context
# Don't export this variable - it should be local to each shell session
_CURRENT_SHELL_PID=$$
if [ -n "$_ENV_SOURCED_PID" ] && [ "$_ENV_SOURCED_PID" = "$_CURRENT_SHELL_PID" ]; then
  return
fi
_ENV_SOURCED_PID=$_CURRENT_SHELL_PID

# Locale
export LANG="en_US.UTF-8"
export LC_ALL="en_US.UTF-8"

# Defaults
export TERM="xterm-256color"
export TERMINAL="xterm"
export COLORTERM="truecolor"

export EDITOR="vi"
export DIFFPROG="vimdiff"
export VISUAL=$EDITOR

# Set default pager (will be overridden if bat is available)
export PAGER="less"
export MANPAGER="less"
export MANWIDTH=120

export BROWSER="firefox"
export READER="xdg-open"
export IMAGE="feh"

export OPENER="xdg-open"

export WM="i3"
export SHELL="/usr/bin/zsh"

# Git repo for dotfiles
export DOTFILES="$HOME/dotfiles"


# Go
# Set go env vars
export GOBIN="$HOME/go/bin"
export GOPATH="$HOME/go"

# Rust
export CARGO_HOME="$XDG_CONFIG_HOME/cargo"

# Node
# Increase max memory
export NODE_OPTIONS="--max-old-space-size=16384"


# set font for Nordic theme
# PKG: nordic-darker-theme-git
export THEME_FONT_FACE="MonoLisa"
export THEME_FONT_SIZE=11

# set default file manager
export FILE_MANAGER="thunar"

# set default video player
export VIDEO_PLAYER="mpv"


# disable telemetry
export DOTNET_CLI_TELEMETRY_OPTOUT=1

# GPG
if [ -t 0 ]; then
  GPG_TTY=$(tty)
  export GPG_TTY
fi

# PATH configuration
# Base paths
PATH="$HOME/.local/bin:$HOME/bin${PATH:+:$PATH}"

#  Emacs Packages
[ -d "$HOME/.emacs.d/bin" ] && PATH="$PATH:$HOME/.emacs.d/bin"

#  Go Packages
[ -d "${GOPATH:-$HOME/go}/bin" ] && PATH="$PATH:${GOPATH:-$HOME/go}/bin"

# Rust Cargo Packages
[ -d "${CARGO_HOME:-$HOME/.config/cargo}/bin" ] && PATH="$PATH:${CARGO_HOME:-$HOME/.config/cargo}/bin"

# Ruby Gems
[ -d "$HOME/.gem/bin" ] && PATH="$PATH:$HOME/.gem/bin"

# ClojureScript
[ -d "/opt/clojurescript/bin" ] && PATH="$PATH:/opt/clojurescript/bin"

# .Net tools
[ -d "$HOME/.dotnet/tools" ] && PATH="$PATH:$HOME/.dotnet/tools"

# Yarn Packages
[ -d "$HOME/.yarn/bin" ] && PATH="$PATH:$HOME/.yarn/bin"

# Dart pub packages
[ -d "$HOME/.pub-cache/bin" ] && PATH="$PATH:$HOME/.pub-cache/bin"

# NPM --global packages
[ -d "$HOME/.npm-global/bin" ] && PATH="$PATH:$HOME/.npm-global/bin"

# Claude
[ -d "$HOME/.claude/local" ] && PATH="$PATH:$HOME/.claude/local"

export PATH
